<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thai lakorns</title>
    <link rel="stylesheet" href="style1.css">
</head>
<body>
    <div class="cards-wrapper">
        <!-- <div class="card" data-id="1">
          <img src="https://dorama.land/uploads/generated/serials/0/v1/rozovyy-greh.jpg?v=1" alt="icon">
          <h4>Розовый грех</h4>
          <p>Кангсадан — романтичная девушка. Она мечтательна и открыта новому. Кангсадан смотрит на мир сквозь призму розовых очков, во всем видит позитивные стороны и не боится искренне улыбаться. В её понимании все легко и прекрасно. Но это не сможет длиться вечно...</p>
          <a href="#!" class="link">6$</a>
        </div>
        <div class="card">
          <img src="https://dorama.land/uploads/generated/serials/0/v1/opavshiy-list.jpg?v=1" alt="icon">
          <h4>Опавший лист</h4>
          <p>Сюжет сериала «Опавший лист» разворачивается вокруг очаровательной девушки по имени Нира. Внешне она просто идеальна, хотя у нее есть своя тайна.</p>
          <a href="#!" class="link">4.99$</a>
        </div>
        <div class="card">
          <img src="https://dorama.land/uploads/generated/serials/1/v1/cvetochnaya-chetverka-smotret-online13.jpg?v=1" alt="icon">
          <h4>Цветочки после ягод</h4>
          <p>Четверо привлекательных и обеспеченных молодых человека становятся ночным кошмаром для невинной школьницы Гойя. Парни ставят себя выше других, позволяют себе делать все, что вздумается и никогда ни с кем не считаются. Тама – глава четверки, больше остальных заинтересован в девушке. И постепенно этот интерес перерос в любовь. Но Гойя никак не отвечает ему взаимностью. Надолго ли?</p>
          <a href="#!" class="link">7.99$</a>
        </div>
        <div class="card">
          <img src="https://dorama.land/uploads/generated/serials/0/v1/kamennoe-serdce11.jpg?v=1" alt="icon">
          <h4>Каменное сердце</h4>
          <p> Мачеха и сводный брат превратили его жизнь в беспросветный ад. Единственным другом в это нелегкое время для него оставалась соседская девочка Мингта, которая также подвергалась жестоким нападкам со стороны родственников.</p>
          <a href="#!" class="link">4$</a>
        </div>
        <div class="card">
          <img src="https://dorama.land/uploads/generated/serials/1/v1/pomni-menya1.jpg?v=1" alt="icon">
          <h4>Помни меня</h4>
          <p>Однажды учительница старших классов в Таиланде предложила ученикам написать письма сверстникам из другой школы. Для анонимности, чтобы авторы чувствовали себя раскрепощенно, она раздала порядковые номера.</p>
          <a href="#!" class="link">10$</a>
        </div>
        <div class="card">
          <img src="https://dorama.land/uploads/generated/serials/1/v1/kinnporsh4.jpg?v=1" alt="icon">
          <h4>КинПорш | КиннПорш</h4>
          <p>Порш учится в Национальном спортивном университете Таиланда и обладает отличной физической формой. Для того чтобы оплачивать своё обучение, парень подрабатывает официантом. Однажды он становится свидетелем драки, в ходе которой группа молодчиков избивает молодого незнакомца.</p>
          <a href="#!" class="link">3.80$</a>
        </div>
        <div class="card">
          <img src="https://dorama.land/uploads/generated/serials/1/v1/sverkayushchaya-zhemchuzhina6.jpg?v=1" alt="icon">
          <h4>Сверкающая жемчужина</h4>
          <p>Свет софитов и танцевальная музыка. Люди, двигающиеся в ритме зажигательных битов. И над всем этим властна Праомук — ведь она работает диджеем и знает, как захватить человеческие сердца. И хотя девушка занимается этим лишь для того, чтобы быстрее выплатить долги семьи, она из тех людей, кто не привык делать что-то спустя рукава.</p>
          <a href="#!" class="link">3.80$</a>
        </div>
        <div class="card">
          <img src="https://dorama.land/uploads/generated/serials/0/v1/massaya.jpg?v=1" alt="icon">
          <h4>Массая</h4>
          <p>Много лет назад в семье Раттанамахаснар произошли изменения: в результате интриг и из-за того, что Сан без одобрения матери женится на мусульманской женщине из «низкого класса», тот вынужден был покинуть дом вместе с любимой и новорожденной дочерью. Спустя годы глава семьи жалеет о содеянном поступке и чувствует вину перед Саном, поэтом просит внука разыскать его, но оказывается уже слишком поздно...</p>
          <a href="#!" class="link">3.80$</a>
        </div> -->
      </div>
      <script>
        let goods = (localStorage.getItem('korzina'))? JSON.parse(localStorage.getItem('korzina')) : [];
        console.log(goods);

        let query = fetch("https://637eed1a5b1cc8d6f936c37d.mockapi.io/category/3/films")
            .then(responce => responce.json())
            .then(json => {
              console.log(json);
              json.forEach(element => {
                let card = document.createElement('div');
                card.classList.add('card')
                card.dataset.id = element.id;
                card.innerHTML = `
                <h4>${element.name}</h4>
                <img src="${element.img}" alt="icon">
                <p>${element.discription}</p>
                <a href="#!" class="link">${element.price}$</a>`;
                document.querySelector('.cards-wrapper').append(card);
              }); 
              
              document.querySelectorAll('.link').forEach(element => {
                element.addEventListener('click',  function (elem){
                  if (goods[element.closest('.card').dataset.id-1]) {
                    goods[element.closest('.card').dataset.id - 1].count++;
                  } else {
                    goods[element.closest('.card').dataset.id - 1] = {
                      id: element.closest('.card').dataset.id,
                      price: element.closest('.card').querySelector('.link').innerText,
                      name: element.closest('.card').querySelector('h4').innerText,
                      count: 1
                    };
                  }
                  localStorage.setItem('korzina', JSON.stringify(goods));
                  console.log(goods)
                });
              })
              
            });

            
            calc_sum();

            console.log(goods);

            function decrement(e) {
            const btn = e.target.parentNode.parentElement.querySelector(
              'button[data-action="decrement"]'
            );
            const target = btn.nextElementSibling;
            let value = Number(target.value);
            value--;
            value = (value < 0)? 0: value;
            target.value = value;
          }
      
            function increment(e) {
            const btn = e.target.parentNode.parentElement.querySelector(
              'button[data-action="decrement"]'
             );
            const target = btn.nextElementSibling;
            let value = Number(target.value);
            value++;
            target.value = value;
          }
      
            const decrementButtons = document.querySelectorAll(
              `button[data-action="decrement"]`
            );
      
            const incrementButtons = document.querySelectorAll(
              `button[data-action="increment"]`
            );
      
            decrementButtons.forEach(btn => {
              btn.addEventListener("click", decrement);
            });
      
            incrementButtons.forEach(btn => {
              btn.addEventListener("click", increment);
             });

        let delete_card = document.querySelectorAll('.remove-icon img');

        function calc_sum() {
          let sum = 0;
          let length = 0;
          goods.forEach(element => {
            if (element) {
              sum += element.price * element.count;
              length++;
            }
          })
          // console.log(price)
          document.querySelector('.h1 span').innerHTML = '(' + length + ')';
          document.querySelector('.price').innerHTML = sum;
        }

        delete_card.forEach(element => {
          element.addEventListener('click', function () {
            let parent = this.closest('.card');
            console.log(parent.dataset.id);
            goods[parent.dataset.id] = null;
            localStorage.setItem('korzina', JSON.stringify(goods));
            parent.parentNode.removeChild(parent);
            calc_sum();
          });
        })
      </script>
</body>
</html>